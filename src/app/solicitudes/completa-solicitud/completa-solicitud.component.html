<form (ngSubmit)="onSubmit()" #SolicitudForm="ngForm" #solicitudForm="ngForm">
	<div class="card">
		<h2 class="card-body text-start">
			<div class="header-solicitud">
				<div class="row">
					<div class="col-md-8">
						<div class="mb-3">
							<h3 class="sol-danger">
								<a routerLink="/tareas/consulta-tareas"> <i class="bi bi-arrow-left-circle azul"></i> {{ solicitud.idSolicitud }} </a>
							</h3>
						</div>
					</div>

					<div class="col-md-4 text-end">
						<button *ngIf="existeMatenedores" type="button" (click)="openModalReasignarUsuario()" class="btn btn-info me-2 mt-1"><i class="fas fa-redo"></i> Reasignar</button>

						<!-- <button *ngIf="!existeMatenedores || existe" type="submit" class="btn btn-info me-2 mt-1" aria-label="Close" [disabled]="!solicitudForm.form.valid"><i class="fas fa-save"></i> Guardar</button> -->

						<!-- <button *ngIf="!existeMatenedores || existe" type="button" (click)="onCompletar()" class="btn btn-info me-2 mt-1" [disabled]="disabledComplete"><i class="fas fa-check-circle icon-size"></i> Completar Tarea</button> -->
						<button *ngIf="!existeMatenedores || existe" type="submit" class="btn btn-info me-2 mt-1"><i class="fas fa-check-circle icon-size"></i> Completar Tarea</button>
					</div>
				</div>

				<div class="row mt-4">
					<div class="col-md-4">
						<div class="input-group mb-3">
							<label class="label-estilo" for="origin">Creado por:</label>

							<span id="origin" name="" style="color: black; font-size: 14px" class="text-start">{{ solicitud.usuarioCreacion }}</span>
						</div>
					</div>

					<div class="col-md-4">
						<div class="input-group mb-3">
							<label class="label-estilo" for="unidadnegocio">Fecha:</label>

							<span id="date" name="" style="color: black; font-size: 14px" class="text-start">{{ this.solicitud.fechaCreacion | date : "yyyy/MM/dd" }}</span>
						</div>
					</div>

					<div class="col-md-4">
						<div class="input-group mb-3">
							<label class="label-estilo" for="unidadnegocio">Nro. Solicitud:</label>
							<span id="solicitud" name="" style="color: black; font-size: 14px" class="text-start">{{ solicitud.idSolicitud }}</span>
						</div>
					</div>
				</div>

				<hr />
			</div>

			<div class="after-header-solicitud"></div>

			<!-- ! Información general -->
			<app-solicitud-seccion-desplegable titleSummary="Información general">
				<div>
					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="tipoSolicitud">Tipo de solicitud</label>

								<span #mivar id="tipoSolicitud" name="idTipoSolicitud" style="color: black; font-size: 14px" class="text-start">{{ solicitud.tipoSolicitud }}</span>
							</div>
						</div>

						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="tipomotivo">Tipo de motivo</label>

								<span id="tipomotivo" name="tipomotivo" style="color: black; font-size: 14px" class="text-start">{{ solicitud.tipoMotivo }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="codigoposicion">Código de posición</label>

								<span id="codigoposicion" name="codigoposicion" style="color: black; font-size: 14px" class="text-start">{{ model.codigoPosicion }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo2" for="descripcionposicion">Descripción de posición</label>

								<span id="descripcionposicion" name="descripcionposicion" style="color: black; font-size: 14px" class="text-start">{{ model.descrPosicion }}</span>
							</div>
						</div>
					</div>

					<div class="row" *ngIf="mostrarSubledger">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="subledger">Subledger</label>

								<span id="subledger" name="subledger" style="color: black; font-size: 14px" class="text-start">{{ model.subledger }}</span>
							</div>
						</div>

						<div class="col-md-6" *ngIf="mostrarSubledger">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="nombreempleado">Empleado</label>

								<span id="nombreempleado" name="nombreempleado" style="color: black; font-size: 14px" class="text-start">{{ model.nombreCompleto }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo2" for="compania">Compañía</label>

								<span id="compania" name="" style="color: black; font-size: 14px" class="text-start">{{ model.compania }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="unidadnegocio">Unidad de negocio</label>

								<span id="unidadnegocio" name="" style="color: black; font-size: 14px" class="text-start">{{ model.unidadNegocio }}</span>
							</div>
						</div>

						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="departamento">Área/Departamento</label>

								<span id="departamento" name="" style="color: black; font-size: 14px" class="text-start">{{ model.departamento }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="tipocargo">Tipo de cargo</label>

								<span id="cargo" name="" style="color: black; font-size: 14px" class="text-start">{{ model.nombreCargo }}</span>
							</div>
						</div>

						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="localidadzona">Localidad/Zona</label>

								<span id="localidadzona" name="" style="color: black; font-size: 14px" class="text-start">{{ model.localidad }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="niveldirección">Nivel de dirección</label>

								<span id="niveldirección" name="" style="color: black; font-size: 14px" class="text-start">{{ model.nivelDir }}</span>
							</div>
						</div>

						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="centrocosto">Centro de costo</label>

								<span id="centrocosto" name="" style="color: black; font-size: 14px" class="text-start">{{ model.nomCCosto }}</span>
							</div>
						</div>
					</div>

					<div class="row" *ngIf="mostrarTipoJustificacionYMision">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="misioncargo">Misión del cargo</label>

								<span id="misioncargo" name="misioncargo" style="color: black; font-size: 14px" class="text-start">{{ model.misionCargo }}</span>
							</div>
						</div>
					</div>

					<div class="row" *ngIf="mostrarTipoJustificacionYMision">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo2" for="justificacion">Justificación</label>

								<span id="justificacion" name="justificacion" style="color: black; font-size: 14px" class="text-start">{{ model.justificacionCargo }}</span>
							</div>
						</div>
					</div>
				</div>
			</app-solicitud-seccion-desplegable>

			<!-- ! Funciones y responsabilidades -->
			<app-solicitud-seccion-desplegable titleSummary="Funciones y responsabilidades">
				<div>
					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo2" for="reporta">Reporta a</label>

								<span id="reporta" name="" style="color: black; font-size: 14px" class="text-start">{{ model.reportaA }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="nivelRepa">Nivel de reporte</label>

								<span id="nivelRepa" name="" style="color: black; font-size: 14px" class="text-start">{{ model.nivelRepa }}</span>
							</div>
						</div>

						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="tipocontrato">Tipo de contrato</label>

								<span id="tipocontrato" name="tipocontrato" style="color: black; font-size: 14px" class="text-start">{{ model.tipoContrato }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center w-100">
								<label class="input-group-text text-start label-estilo2" for="supervisaa">Supervisa a</label>

								<span id="supervisaa" name="" style="color: black; font-size: 14px" class="text-start w-75">{{ model.supervisaA }}</span>
							</div>
						</div>
					</div>
				</div>
			</app-solicitud-seccion-desplegable>

			<!-- ! Tipo de variable -->
			<app-solicitud-seccion-desplegable titleSummary="Sueldo/Tipo de variable">
				<div>
					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="sueldo">Sueldo</label>

								<span id="sueldo" name="sueldo" style="color: black; font-size: 14px" class="text-start">$ {{ model.sueldo | number : "1.2-2" }}</span>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="mensual">Mensual</label>

								<span id="mensual" name="mensual" style="color: black; font-size: 14px" class="text-start">$ {{ model.sueldoMensual | number : "1.2-2" }}</span>
							</div>
						</div>

						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="trimestral">Trimestral</label>

								<span id="trimestral" name="trimestral" style="color: black; font-size: 14px" class="text-start">$ {{ model.sueldoTrimestral | number : "1.2-2" }}</span>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="semestral">Semestral</label>

								<span id="semestral" name="semestral" style="color: black; font-size: 14px" class="text-start">$ {{ model.sueldoSemestral | number : "1.2-2" }}</span>
							</div>
						</div>

						<div class="col-md-6">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo" for="anual">Anual</label>

								<span id="anual" name="anual" style="color: black; font-size: 14px" class="text-start">$ {{ model.sueldoAnual | number : "1.2-2" }}</span>
							</div>
						</div>
					</div>
				</div>
			</app-solicitud-seccion-desplegable>

			<!-- ! Aprobadores de la solicitud -->
			<app-solicitud-seccion-desplegable titleSummary="Aprobadores de la solicitud">
				<div>
					<div class="accordion" id="accordionExample">
						<div *ngFor="let nivelItem of dataAprobacionesPorPosicion[keySelected]; let i = index" class="accordion-item">
							<div class="accordion-header">
								<button class="accordion-button" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + i" aria-expanded="true" [attr.aria-controls]="'collapse' + i" style="display: block">
									<div class="row" style="align-items: center; justify-content: space-around">
										<div class="col">{{ nivelItem.nivelAprobacionType.ruta }}</div>

										<div class="col">
											{{ nivelItem.aprobador.usuario !== "" && nivelItem.aprobador.usuario !== undefined && nivelItem.aprobador.usuario != null ? nivelItem.aprobador.codigoPosicion + "-" + nivelItem.aprobador.usuario : "No aplica" }}
										</div>

										<div class="col">
											{{
												nivelItem.nivelAprobacionType.nivelAprobacionRuta.toUpperCase().includes("REGISTRARSOLICITUD")
													? "Registrar Solicitud"
													: nivelItem.nivelAprobacionType.nivelAprobacionRuta.toUpperCase().includes("CANDIDATO")
														? "Selección de Candidato"
														: nivelItem.nivelAprobacionType.nivelAprobacionRuta.toUpperCase().includes("COMENTARIOJEFE")
															? "Registrar Comentario Jefe"
															: nivelItem.nivelAprobacionType.nivelAprobacionRuta.toUpperCase().includes("COMENTARIORRHH")
																? "Registrar Comentario RR.HH."
																: nivelItem.nivelAprobacionType.nivelAprobacionRuta.toUpperCase().includes("COMENTARIOSOLICITANTE")
																	? "Registrar Comentario Solicitante"
																	: nivelItem.nivelAprobacionType.nivelAprobacionRuta
											}}
										</div>
									</div>
								</button>
							</div>

							<div [id]="'collapse' + i" class="accordion-collapse collapse" [ngClass]="{ show: i === 0 }" data-bs-parent="#accordionExample">
								<div class="row">
									<div class="col">
										<div class="input-group">
											<label for="lvl1descripcion">Descripción de la posición</label>

											&nbsp;

											<span id="lvl1descripcion" name="" style="color: black; font-size: 14px">{{ nivelItem.aprobador.descripcionPosicion !== "" && nivelItem.aprobador.descripcionPosicion !== undefined && nivelItem.aprobador.descripcionPosicion != null ? nivelItem.aprobador.descripcionPosicion : "No aplica" }}</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</app-solicitud-seccion-desplegable>

			<!-- ! Atención de los aprobadores -->
			<app-solicitud-seccion-desplegable titleSummary="Atención de los aprobadores">
				<div>
					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-start">
								<label class="input-group-text text-start label-estilo2">Aprobadores dinámicos</label>

								<div>
									<div class="row" *ngFor="let item of dataComentariosAprobaciones">
										<span style="color: black; font-size: 14px" class="text-start">{{ item.text }}</span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-start">
								<label class="input-group-text text-start label-estilo2">Gerente de RRHH Corporativo</label>

								<div>
									<div class="row" *ngFor="let item of dataComentariosAprobacionesRRHH">
										<span style="color: black; font-size: 14px">{{ item.text }}</span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-start">
								<label class="input-group-text text-start label-estilo2">Comité de Remuneraciones</label>

								<div>
									<div class="row" *ngFor="let item of dataComentariosAprobacionesCREM">
										<span style="color: black; font-size: 14px">{{ item.text }}</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</app-solicitud-seccion-desplegable>

			<!-- ! Atención de solicitud -->
			<app-solicitud-seccion-desplegable titleSummary="Atención de solicitud" [isOpen]="true">
				<div>
					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo2" for="desicion">Decisión a tomar</label>

								<div class="d-flex gap-3" role="group" aria-label="Basic example" id="desicion">
									<button type="button" class="btn" (click)="process('aprobar')" [ngClass]="{ 'btn-primary btn-unselected': !isSelected('aprobar'), 'btn-selected': isSelected('aprobar') }" value="aprobar">Aprobar</button>

									<button type="button" class="btn" [ngClass]="{ 'btn-primary btn-unselected': !isSelected('devolver'), 'btn-selected': isSelected('devolver') }" (click)="process('devolver')" value="devolver">Devolver</button>

									<button type="button" class="btn" [ngClass]="{ 'btn-primary btn-unselected': !isSelected('rechazar'), 'btn-selected': isSelected('rechazar') }" (click)="process('rechazar')" value="rechazar">Cancelar</button>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div class="input-group mb-3 align-items-center">
								<label class="input-group-text text-start label-estilo2" for="observacion">{{ observaciontexto }}</label>

								<textarea [(ngModel)]="textareaContent" id="observacion" name="observacion" #observacion="ngModel" [required]="isRequired" style="color: black; font-size: 14px" [placeholder]="campoObligatorio"></textarea>
							</div>
						</div>
					</div>

					<div class="row" *ngIf="isFechaMaximaVisible">
						<div class="col">
							<div class="input-group mb-3 contenedor">
								<label class="input-group-text text-start label-estilo2" for="aprobar">Fecha máxima de espera</label>

								<div class="datepicker-container">
									<mat-form-field appearance="outline">
										<mat-label>Fecha</mat-label>

										<input matInput [matDatepicker]="picker" [min]="minDateValidation" [max]="maxDateValidation" [(ngModel)]="selectedDate" name="espera-maxima" />

										<mat-hint>Máximo 365 días después de hoy</mat-hint>

										<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>

										<mat-datepicker #picker></mat-datepicker>
									</mat-form-field>
								</div>
							</div>
						</div>
					</div>
				</div>
			</app-solicitud-seccion-desplegable>
		</h2>
	</div>
</form>
